#!/bin/sh
#
# redminesvn
#
# Transform redmine project url to svn repository url, will use trunk as default path
#
# For linux compatibility of pbpaste and pbcopy check http://whereswalden.com/2009/10/23/pbcopy-and-pbpaste-for-linux/
#

set -e

# defaults url to first argument
url=$1

# when no argument set, try to find it in clipboard
if [ -z $url ]
then
    url="$(pbpaste)"
fi

# check if url is really an url and is a redmine url (we test on /projects/)
if [[ $url == https*/projects/* ]]
then
    svnurl="$(echo $url | sed 's/\(.*\)\/projects\/\([a-z\-]*\).*/\1\/svn\/\2\/trunk\//')"
    # copy git url to pasteboard
    `echo $svnurl | pbcopy`
    echo "$svnurl"
else
    echo "No redmine url found as first argument or on clipboard" >&2
fi
